<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE-edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Daily Arrivals and Depatures</title>
		<link rel="stylesheet" href="css/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="font/bootstrap-icons.css" />
		<link rel="stylesheet" type="text/css" href="/stylesheets/style.css" />
		<script lang="javascript" src="js/bootstrap.min.js"></script>
		<script>
			function save(id) {
				const res_id = id;
				const res_status = document.getElementById("status" + id).value;
				const res_notes = document.getElementById("notes" + id).value;
				fetch("./reservations", {
					method: "POST",
					body: JSON.stringify({
						reservation_id: res_id,
						reservation_status: res_status,
						reservation_notes: res_notes,
					}),
					headers: {
						"Content-type": "application/json; charset=UTF-8",
					},
				});
			}

			function checkDates(event) {
				// Get the two passwords entered
				const dateTo = document.getElementById("dateTo").value;
				const dateFrom = document.getElementById("dateFrom").value;
				let datesValid = false;
				let message = "";
				if (dateFrom == "") {
					message = "Please enter date From";
				} else if (dateTo == "") {
					message = "Please enter date To";
				} else if (dateFrom > dateTo) {
					message = "Date From cannot be greater than Date To";
				} else {
					datesValid = true;
				}

				if (!datesValid) {
					document.getElementById("message").innerHTML = message;
					event.preventDefault();
				}
			}
		</script>
	</head>
	<body>
		<%- include('nav'); %>
		<main class="px-3">
			<div style="text-align: center">
				<h3>
					Reservations listed from: <%= new Date(locals.dateFrom +
					"T00:00:00").toLocaleString().split(',')[0] %> to: <%= new Date(locals.dateTo +
					"T00:00:00").toLocaleString().split(',')[0] %>
				</h3>
			</div>

			<% if (locals.reservations.length) { %>
			<div class="d-flex flex-row flex-wrap justify-content-center">
				<div class="rounded m-2 flex-grow-1">
					<table
						class="table table-striped table-hover font-size-11-for-mobile"
						style="border: 1px solid dodgerblue">
						<thead>
							<tr style="text-align: left">
								<th scope="col">Site</th>
								<th scope="col">Name</th>
								<th scope="col">Dates</th>
								<th scope="col">Phone</th>
								<th scope="col">Reservation Status</th>
							</tr>
						</thead>
						<tbody>
							<% for (reservation of locals.reservations) { %>

							<tr style="text-align: left">
								<td style="vertical-align: middle">
									<%- reservation.site_name %> (<%- reservation.site_length_in_feet %>ft)
								</td>
								<td style="vertical-align: middle">
									<%- reservation.first_name %> <%- reservation.last_name %>
								</td>
								<td style="vertical-align: middle">
									<%- new Date(reservation.start_date).toLocaleString().split(',')[0] %> - <%- new
									Date(reservation.end_date).toLocaleString().split(',')[0] %>
								</td>
								<td style="vertical-align: middle"><%- reservation.phone %></td>
								<td style="vertical-align: middle">
									<select
										name="status<%- reservation.reservation_id %>"
										id="status<%- reservation.reservation_id %>"
										onblur="save('<%- reservation.reservation_id %>')">
										<% if(reservation.reservation_status == "reserved") { %>
										<option value="reserved" selected>reserved</option>
										<% } else { %>
										<option value="reserved">reserved</option>
										<% } %> <% if(reservation.reservation_status == "checked in") { %>
										<option value="checked in" selected>checked in</option>
										<% } else { %>
										<option value="checked in">checked in</option>
										<% } %> <% if(reservation.reservation_status == "checked out") { %>
										<option value="checked out" selected>checked out</option>
										<% } else { %>
										<option value="checked out">checked out</option>
										<% } %> <% if(reservation.reservation_status == "canceled") { %>
										<option value="canceled" selected>canceled</option>
										<% } else { %>
										<option value="canceled">canceled</option>
										<% } %> <% if(reservation.reservation_status == "no show") { %>
										<option value="no show" selected>no show</option>
										<% } else { %>
										<option value="no show">no show</option>
										<% } %>n>
									</select>
								</td>
							</tr>
							<tr>
								<td colspan="3"></td>
								<td colspan="2">
									<label for="notes<%-reservation.reservation_id%>">Notes</label>
									<textarea
										class="w-100"
										id="notes<%-reservation.reservation_id%>"
										onblur="save('<%- reservation.reservation_id %>')"
										name="notes<%- reservation.reservation_id %>">
										<%- reservation.reservation_notes %>
									</textarea
									>
								</td>
							</tr>
							<% } %>
						</tbody>
					</table>
				</div>
			</div>
			<% } else { %>
			<p class="text-center">No reservations within dates listed</p>
			<% } %>

			<div
				class="d-flex justify-content-center flex-grow-1 half-width-centered-margin-non-mobile"
				style="border: 2px solid black; text-align: center">
				<form
					id="availForm"
					class="my-2 d-flex flex-column align-items-center"
					method="post"
					onsubmit="return checkDates(event);">
					<h3>Generate FamCamp Report</h3>
					<div class="w-100 d-flex flex-row align-items-center">
						<div class="my-2">
							<label for="dateFrom">From date:</label>
							<input type="date" id="dateFrom" name="dateFrom" value="<%- locals.dateFrom %>" />
						</div>
						<div class="my-2 mx-2">
							<label for="dateTo">To date:</label>
							<input type="date" id="dateTo" name="dateTo" value="<%- locals.dateTo %>" />
						</div>
					</div>
					<br style="clear: both" />
					<button type="submit" class="btn btn-primary">Generate</button>
				</form>
				<div>
					<p id="message" class="text-danger"><%- locals.message %></p>
				</div>
			</div>
		</main>
	</body>
</html>
