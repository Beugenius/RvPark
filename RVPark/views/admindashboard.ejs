<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE-edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Daily Arrivals and Depatures</title>
		<link rel="stylesheet" href="css/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="font/bootstrap-icons.css" />
		<link rel="stylesheet" type="text/css" href="/stylesheets/style.css" />
		<script lang="javascript" src="js/bootstrap.min.js"></script>
		<script>
			function checkInReservation(reservation_id) {
				document.getElementById("reservation_id").value = reservation_id;
				document.getElementById("reservation_status").value = "checked in";
				document.getElementById("_method").value = "PUT";
			}

			function checkOutReservation(reservation_id) {
				document.getElementById("reservation_id").value = reservation_id;
				document.getElementById("reservation_status").value = "checked out";
				document.getElementById("_method").value = "PUT";
			}

			function checkDates(event) {
				// Get the two passwords entered
				const dateTo = document.getElementById("dateTo").value;
				const dateFrom = document.getElementById("dateFrom").value;
				let datesValid = false;
				let message = "";
				if (dateFrom == "") {
					message = "Please enter date From";
				} else if (dateTo == "") {
					message = "Please enter date To";
				} else if (dateFrom > dateTo) {
					message = "Date From cannot be greater than Date To";
				} else {
					datesValid = true;
				}

				if (!datesValid) {
					document.getElementById("message").innerHTML = message;
					event.preventDefault();
				}
			}
		</script>
	</head>
	<body>
		<%- include('nav'); %>
		<main class="px-3">
			<div style="text-align: center">
				<h3>
					Today's Arrivals and Departures : <%= new Date(locals.today +
					"T00:00:00").toLocaleString().split(',')[0] %>
				</h3>
			</div>
			<div>
				<form method="post">
					<div class="d-flex flex-row flex-wrap justify-content-center">
						<div class="rounded m-2 flex-grow-1">
							<h4>Today's Arrivals</h4>
							<% if (locals.arrivals.length) { %>
							<table class="table table-striped table-hover" style="border: 1px solid dodgerblue">
								<thead>
									<tr>
										<th scope="col">Site</th>
										<th scope="col">First Name</th>
										<th scope="col">Last Name</th>
										<th scope="col">Phone</th>
										<th scope="col" style="text-align: center">Check In</th>
									</tr>
								</thead>
								<tbody>
									<% for (arrival of locals.arrivals) { %>
									<tr>
										<td><%- arrival.site_name %></td>
										<td><%- arrival.first_name %></td>
										<td><%- arrival.last_name %></td>
										<td><%- arrival.phone %></td>
										<% if (arrival.reservation_status == "reserved") { %>
										<td style="text-align: center">
											<button
												type="submit"
												onclick="checkInReservation('<%- arrival.reservation_id %>')"
												class="btn btn-primary">
												Check In
											</button>
										</td>
										<% } else { %>
										<td style="text-align: center"><%- arrival.reservation_status %></td>
										<% } %>
									</tr>
									<% } %>
								</tbody>
							</table>
							<% } else { %>
							<p class="text-center">No arrivals expected for today</p>
							<% } %>
						</div>
						<div class="rounded m-2 flex-grow-1">
							<h4>Today's Departures</h4>
							<% if (locals.departures.length) { %>
							<table class="table table-striped table-hover" style="border: 1px solid dodgerblue">
								<thead>
									<tr>
										<th scope="col">Site</th>
										<th scope="col">First Name</th>
										<th scope="col">Last Name</th>
										<th scope="col">Phone</th>
										<th scope="col" style="text-align: center;">Check Out</th>
									</tr>
								</thead>
								<tbody>
									<% for (departure of locals.departures) { %>
									<tr>
										<td><%- departure.site_name %></td>
										<td><%- departure.first_name %></td>
										<td><%- departure.last_name %></td>
										<td><%- departure.phone %></td>
										<% if (departure.reservation_status == "checked in" || departure.reservation_status == "reserved") { %>
										<td style="text-align: center">
											<button
												type="submit"
												class="btn btn-primary"
												onclick="checkOutReservation('<%- departure.reservation_id %>')">
												Check Out
											</button>
										</td>
										<% } else { %>
										<td style="text-align: center"><%- departure.reservation_status %></td>
										<% } %>
									</tr>
									<% } %>
								</tbody>
							</table>

							<% } else { %>
							<p class="">No departures expected for today</p>
							<% } %>
						</div>
					</div>
					<input type="hidden" id="reservation_id" name="reservation_id" value="" />
					<input type="hidden" id="reservation_status" name="reservation_status" value="" />
					<input type="hidden" id="_method" name="_method" value="" />
				</form>
			</div>
			<br style="clear: both" />
			<div
				class="d-flex justify-content-center flex-grow-1 half-width-centered-margin-non-mobile"
				style="border: 2px solid black; text-align: center">
				<form
					id="availForm"
					class="my-2 d-flex flex-column align-items-center"
					method="post"
					onsubmit="return checkDates(event);">
					<h3>Generate FamCamp Report</h3>
					<div class="w-100 d-flex flex-row align-items-center">
						<div class="my-2">
							<label for="dateFrom">From date:</label>
							<input type="date" id="dateFrom" name="dateFrom" value="<%- locals.dateFrom %>" />
						</div>
						<div class="my-2 mx-2">
							<label for="dateTo">To date:</label>
							<input type="date" id="dateTo" name="dateTo" value="<%- locals.dateTo %>" />
						</div>
					</div>
					<br style="clear: both" />
					<button type="submit" class="btn btn-primary">Generate</button>
				</form>
				<div>
					<p id="message" class="text-danger"><%- locals.message %></p>
				</div>
			</div>
		</main>
	</body>
</html>
