<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE-edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Reservations</title>
		<link rel="stylesheet" href="css/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="font/bootstrap-icons.css" />
	</head>
	<body>
		<%- include('nav'); %>
		<main class="px-3">
			<h3>Reservations</h3>
			<div class="rounded d-flex justify-content-center m-2">
				<%if(locals.reservations && locals.reservations.length > 0) { %>
				<table class="table table-striped table-hover">
					<thead>
						<tr>
							<th scope="col">Reservation Number</th>
							<th scope="col">Site</th>
							<th scope="col">Date Range</th>
							<th scope="col">Status</th>
							<th scope="col">Options</th>
						</tr>
					</thead>
					
					<tbody>
						<% for(reservation of locals.reservations) { 
							let formattedStartDate = new Date(reservation.start_date).toLocaleString("default", {
								year: "numeric",
								day: "2-digit",
								month: "short",
							});
							let formattedEndDate = new Date(reservation.end_date).toLocaleString("default", {
								year: "numeric",
								day: "2-digit",
								month: "short",
							});
							%>
							<tr>
								<td><%-reservation.reservation_id%></td>
								<td><%-reservation.site_name%></td>
								<td><%-formattedStartDate%> - <%-formattedEndDate%></td>
								<td><%-reservation.reservation_status.charAt(0).toUpperCase() + reservation.reservation_status.slice(1)%></td>
								<td>
									<form id="<%- reservation.reservation_id %>-form" action="/cancel" method="post">
										<input type="hidden" name="reservationId" value="<%- reservation.reservation_id %>" />
										<input type="hidden" name="startDate" value="<%-formattedStartDate%>" />
										<input type="hidden" name="endDate" value="<%-formattedEndDate%>" />
										<input type="hidden" name="siteName" value="<%-reservation.site_name%>" />
										<input type="hidden" name="startCancellation" value="true" />
										<% if (reservation.reservation_status !== "canceled") { %>
											<button type="submit" class="btn btn-primary">Cancel</button>
										<% } %>
									</form>
								</td>
							</tr>
						<% } %>
					</tbody>
				</table>
				<% } else { %>
					<div>
						<p>
							No reservations to show! Check out our <a href="availability">availabilities!</a>
						</p>
					</div>
				<% } %>
			</div>
		</main>
	</body>
</html>
